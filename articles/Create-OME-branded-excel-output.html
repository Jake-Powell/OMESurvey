<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Create OME branded excel output • OMESurvey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create OME branded excel output">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OMESurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Create-OME-branded-excel-output.html">Create OME branded excel output</a></li>
    <li><a class="dropdown-item" href="../articles/Create-survey-figures.html">Create survey figures</a></li>
    <li><a class="dropdown-item" href="../articles/Preparation-and-initial-survey-analysis.html">Preparation and initial survey analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create OME branded excel output</h1>
            
      

      <div class="d-none name"><code>Create-OME-branded-excel-output.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jake-powell.github.io/OMESurvey/">OMESurvey</a></span><span class="op">)</span></span></code></pre></div>
<p><em>In this example we show how to go from raw survey data to
formatted excel outputs.</em></p>
<p>We need to load in some fake survey results.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="fu">OMESurvey</span><span class="fu">::</span><span class="va"><a href="../reference/survey_example.html">survey_example</a></span></span>
<span><span class="co"># Clean 1. </span></span>
<span><span class="co"># B) NAs</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">[</span><span class="va">data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">'N-A'</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="op">)</span> <span class="co"># commented out for example.</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># C + D) School ID and combine school and class information.</span></span>
<span><span class="va">school</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Barcode_ID</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">school_and_class</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">school</span>,<span class="st">'__'</span>, <span class="va">data</span><span class="op">$</span><span class="va">`Group_/_class`</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Combine into a cleaned dataset. </span></span>
<span><span class="va">data</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">school</span>, <span class="va">school_and_class</span>, <span class="va">data</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 484 × 68</span></span></span>
<span><span class="co">#&gt;    Barcode_ID First_Name Surname Group_._class school school_and_class</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1200800551 Jake       Powell  15            008    008__15         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1200800439 Jake       Powell  11            008    008__11         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1200800442 Jake       Powell  11            008    008__11         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1200800501 Jake       Powell  13            008    008__13         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1200800539 Jake       Powell  14            008    008__14         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1200800500 Jake       Powell  13            008    008__13         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1200800511 Jake       Powell  13            008    008__13         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1200800493 Jake       Powell  13            008    008__13         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1200800498 Jake       Powell  13            008    008__13         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1200800488 Jake       Powell  12            008    008__12         </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 474 more rows</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 62 more variables:</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Tick_Appropriate_Box_Only_if_the_Child_did_not_take_the_Test &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Theme_1__Question_1 &lt;chr&gt;, Theme_1__Question_2 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Theme_1__Question_3 &lt;chr&gt;, Theme_1__Question_4 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Theme_1__Question_5 &lt;chr&gt;, Theme_1__Question_6 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   Theme_2__Question_7 &lt;chr&gt;, Theme_2__Question_8 &lt;chr&gt;, …</span></span></span></code></pre></div>
<p>We can see that the data is formatted such that each row corresponds
to an individual’s response to the survey where the initial columns are
the individuals demographics followed by response to survey questions.
Moreover, note that the column names of questions is of the format
YY_<em>ZZ, where YY is the theme and ZZ the question, where ’ ’ are
replaced with ’</em>’ and ‘?’ with ‘XX’ such as
<code>Theme_1__Question_1</code>.</p>
<p>Now we can create some excel workbooks with breakdowns of how
questions were answered overall or by demographics.</p>
<div class="section level3">
<h3 id="a-single-question-with-demographics">A single question with demographics<a class="anchor" aria-label="anchor" href="#a-single-question-with-demographics"></a>
</h3>
<p>Show the results for Maths in Year 7:I am doing well in maths across
class, school and sex.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span> <span class="op">=</span> <span class="fu">OMESurvey</span><span class="fu">::</span><span class="fu"><a href="../reference/to_sheet_single_survey_question.html">to_sheet_single_survey_question</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                                                question_column <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                                demographic_columns <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>                                                sheet <span class="op">=</span> <span class="st">'Table 1'</span><span class="op">)</span></span>
<span><span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html" class="external-link">saveWorkbook</a></span><span class="op">(</span><span class="va">wb</span>, file <span class="op">=</span> <span class="st">'example1.xlsx'</span><span class="op">)</span></span></code></pre></div>
<p>If wanted you can use other survey questions as demographic columns
to see the relationship between two questions.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span> <span class="op">=</span> <span class="fu">OMESurvey</span><span class="fu">::</span><span class="fu"><a href="../reference/to_sheet_single_survey_question.html">to_sheet_single_survey_question</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                                                question_column <span class="op">=</span> <span class="fl">5</span>,</span>
<span>                                                demographic_columns <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span>,</span>
<span>                                                sheet <span class="op">=</span> <span class="st">'Table 2'</span><span class="op">)</span></span>
<span><span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html" class="external-link">saveWorkbook</a></span><span class="op">(</span><span class="va">wb</span>, file <span class="op">=</span> <span class="st">'example2.xlsx'</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="summary-across-a-theme">Summary across a theme<a class="anchor" aria-label="anchor" href="#summary-across-a-theme"></a>
</h3>
<p>Choose a theme and create a summary table of survey responses in the
theme. (Each theme must have the same allowable values, i.e. agree,
disagree, etc)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">wb</span> <span class="op">=</span> <span class="fu">OMESurvey</span><span class="fu">::</span><span class="fu"><a href="../reference/to_sheet_theme_summary.html">to_sheet_theme_summary</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>, theme <span class="op">=</span> <span class="st">'Theme 1'</span><span class="op">)</span></span>
<span><span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html" class="external-link">saveWorkbook</a></span><span class="op">(</span><span class="va">wb</span>, file <span class="op">=</span> <span class="st">'example3.xlsx'</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
<div class="section level3">
<h3 id="an-excel-document-across-all-questions">An excel document across all questions<a class="anchor" aria-label="anchor" href="#an-excel-document-across-all-questions"></a>
</h3>
<p>We can use the above functions to make an excel workbook with
multiple sheets (one for each question), and add hyperlinking to a table
of contents sheet (using <code><a href="../reference/add_TOC_sheet.html">add_TOC_sheet()</a></code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">question_columns</span> <span class="op">=</span> <span class="fl">5</span><span class="op">:</span><span class="fl">15</span></span>
<span><span class="va">demographic_columns</span> <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">4</span></span>
<span><span class="va">wb</span> <span class="op">&lt;-</span> <span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/createWorkbook.html" class="external-link">createWorkbook</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">question_columns</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">wb</span> <span class="op">=</span> <span class="fu"><a href="../reference/to_sheet_single_survey_question.html">to_sheet_single_survey_question</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                                       question_column <span class="op">=</span> <span class="va">question_columns</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>                                       demographic_columns <span class="op">=</span> <span class="va">demographic_columns</span>,</span>
<span>                                       sheet <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">'Table '</span>,<span class="va">i</span><span class="op">)</span>,</span>
<span>                                       wb <span class="op">=</span> <span class="va">wb</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Add TOC sheet (with hyperlinks to individual tables)</span></span>
<span><span class="va">questions</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="va">question_columns</span><span class="op">]</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="st">'__'</span>,<span class="st">': '</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="st">'_'</span>,<span class="st">' '</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="st">'XX'</span>,<span class="st">'?'</span><span class="op">)</span> </span>
<span><span class="va">wb</span> <span class="op">=</span> <span class="fu"><a href="../reference/add_TOC_sheet.html">add_TOC_sheet</a></span><span class="op">(</span><span class="va">wb</span>, link_text <span class="op">=</span> <span class="va">questions</span><span class="op">)</span></span>
<span><span class="fu">openxlsx</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/openxlsx/man/saveWorkbook.html" class="external-link">saveWorkbook</a></span><span class="op">(</span><span class="va">wb</span>, file <span class="op">=</span> <span class="st">'all_questions_with_TOC.xlsx'</span>, overwrite <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<hr>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jake Powell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
