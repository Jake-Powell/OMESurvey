<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Preparation and initial survey analysis • OMESurvey</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Preparation and initial survey analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">OMESurvey</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Create-OME-branded-excel-output.html">Create OME branded excel output</a></li>
    <li><a class="dropdown-item" href="../articles/Create-survey-figures.html">Create survey figures</a></li>
    <li><a class="dropdown-item" href="../articles/Preparation-and-initial-survey-analysis.html">Preparation and initial survey analysis</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<link href="Preparation-and-initial-survey-analysis_files/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet">
<script src="Preparation-and-initial-survey-analysis_files/htmlwidgets-1.6.4/htmlwidgets.js"></script><link href="Preparation-and-initial-survey-analysis_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="Preparation-and-initial-survey-analysis_files/datatables-binding-0.33/datatables.js"></script><link href="Preparation-and-initial-survey-analysis_files/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="Preparation-and-initial-survey-analysis_files/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="Preparation-and-initial-survey-analysis_files/dt-core-1.13.6/js/jquery.dataTables.min.js"></script><script src="Preparation-and-initial-survey-analysis_files/jszip-1.13.6/jszip.min.js"></script><script src="Preparation-and-initial-survey-analysis_files/pdfmake-1.13.6/pdfmake.js"></script><script src="Preparation-and-initial-survey-analysis_files/pdfmake-1.13.6/vfs_fonts.js"></script><link href="Preparation-and-initial-survey-analysis_files/dt-ext-buttons-1.13.6/css/buttons.dataTables.min.css" rel="stylesheet">
<script src="Preparation-and-initial-survey-analysis_files/dt-ext-buttons-1.13.6/js/dataTables.buttons.min.js"></script><script src="Preparation-and-initial-survey-analysis_files/dt-ext-buttons-1.13.6/js/buttons.html5.min.js"></script><script src="Preparation-and-initial-survey-analysis_files/dt-ext-buttons-1.13.6/js/buttons.colVis.min.js"></script><script src="Preparation-and-initial-survey-analysis_files/dt-ext-buttons-1.13.6/js/buttons.print.min.js"></script><link href="Preparation-and-initial-survey-analysis_files/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="Preparation-and-initial-survey-analysis_files/crosstalk-1.2.1/js/crosstalk.min.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Preparation and initial survey analysis</h1>
            
      

      <div class="d-none name"><code>Preparation-and-initial-survey-analysis.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://jake-powell.github.io/OMESurvey/">OMESurvey</a></span><span class="op">)</span></span></code></pre></div>
<p><em>This article shows how to use tools from </em>
<strong>OMESurvey</strong> <em>to check and clean the provided survey
data and produce an initial report on ‘missingness’ in the
survey</em></p>
<p>In this article we will show how to prepare and perform initial
survey analysis on fake data based on the year 7 pilot study. This fake
data has the same structure as those we receive. We show the data for 5
participants (transposed so the table is easier to see).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">=</span> <span class="fu">OMESurvey</span><span class="fu">::</span><span class="va"><a href="../reference/survey_example.html">survey_example</a></span></span>
<span></span>
<span><span class="co"># Remove the themes and add spacing to imagine how the data will arrive)</span></span>
<span><span class="va">split</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_split.html" class="external-link">str_split</a></span><span class="op">(</span><span class="st">'__'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">split</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span><span class="kw">if</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">{</span><span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">}</span> ; <span class="va">x</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">}</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/unlist.html" class="external-link">unlist</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span><span class="st">'_'</span>, <span class="st">' '</span><span class="op">)</span></span></code></pre></div>
<div class="datatables html-widget html-fill-item" id="htmlwidget-ac96cb3ee4656e2e9ec3" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-ac96cb3ee4656e2e9ec3">{"x":{"filter":"none","vertical":false,"extensions":["Buttons"],"data":[["Barcode ID","First Name","Surname","Group / class","Tick Appropriate Box Only if the Child did not take the Test","Question 1","Question 2","Question 3","Question 4","Question 5","Question 6","Question 7","Question 8","Question 9","Question 10","Question 11","Question 12","Question 13","Question 14","Question 15","Question 16","Question 17","Question 18","Question 19","Question 20","Question 21","Question 22","Question 23","Question 24","Question 25","Question 26","Question 27","Question 28","Question 29","Question 30","Question 31","Question 32","Question 33","Question 34","Question 35","Question 36","Question 37","Question 38","Question 39","Question 40","Question 41","Question 42","Question 43","Question 44","Question 45","Question 46","Question 47","Question 48","Question 49","Question 50","Question 51","Question 52","Question 53","Question 54","Question 55","Question 56","Question 57","Question 58","Question 59","Question 60","Question 61"],["1200800551","Jake","Powell","15","N-A","Agree a lot","Neither","Agree a little","Agree a little","Agree a lot","Agree a little","Agree a little","Agree a lot","Neither","Agree a lot","N-A","Agree a little","Agree a little","Most of the time","Some of the time","Most of the time","Some of the time","Some of the time","N-A","Most of the time","N-A","Most of the time","Half the time","N-A","Almost never","Never","N-A","Never","Never","N-A","Agree a lot","Agree a lot","N-A","Agree a lot","Agree a lot","Disagree a lot","N-A","Disagree a lot","N-A","N-A","Disagree a little","N-A","Neither","Disagree a little","Disagree a lot","Agree a little","N-A","Neither","Neither","Neither","Disagree a lot","Neither","Agree a little","Disagree a lot","Agree a little","Agree a little","Agree a lot","N-A","Agree a little","N-A","Disagree a little"],["1200800439","Jake","Powell","11","N-A","Agree a lot","Neither","Agree a lot","Agree a little","Agree a lot","Agree a little","Agree a little","Neither","Agree a lot","Agree a lot","Neither","Agree a little","Agree a little","Most of the time","Most of the time","Most of the time","N-A","Most of the time","N-A","Almost always","Most of the time","Some of the time","Some of the time","N-A","Some of the time","Never","N-A","N-A","Never","Agree a lot","Agree a lot","Disagree a little","Disagree a little","Disagree a lot","Agree a little","Disagree a lot","Disagree a little","N-A","Neither","Agree a little","Disagree a lot","Agree a little","N-A","N-A","Agree a little","Disagree a little","Neither","Agree a little","Neither","Disagree a lot","Agree a lot","Disagree a lot","N-A","Agree a lot","Neither","N-A","Neither","Agree a little","Agree a lot","Agree a lot","Neither"],["1200800442","Jake","Powell","11","N-A","Agree a little","N-A","Agree a little","N-A","Disagree a little","N-A","Agree a lot","Agree a little","Disagree a little","Disagree a little","Neither","Disagree a little","Disagree a lot","Most of the time","N-A","Almost always","N-A","Some of the time","Some of the time","Almost always","Half the time","Almost Never","N-A","Some of the time","Most of the time","N-A","Never","Never","Never","Neither","N-A","Agree a lot","N-A","Disagree a lot","Neither","N-A","Disagree a lot","N-A","Disagree a lot","Agree a lot","Disagree a little","Disagree a lot","Disagree a lot","Neither","Disagree a lot","N-A","Agree a lot","Agree a little","Disagree a little","Neither","Disagree a lot","Agree a little","N-A","Agree a little","Agree a little","Agree a little","Disagree a lot","Agree a little","Agree a lot","N-A","N-A"],["1200800501","Jake","Powell","13","N-A","Agree a little","N-A","Agree a little","Agree a little","Disagree a lot","Agree a lot","Agree a lot","Agree a lot","Agree a little","N-A","N-A","Neither","Neither","Half the time","Some of the time","Most of the time","N-A","Most of the time","Almost never","Most of the time","Most of the time","Most of the time","Some of the time","Almost always","N-A","N-A","Never","N-A","N-A","N-A","Disagree a little","Agree a little","Agree a little","Agree a little","Agree a lot","Disagree a little","Disagree a lot","Neither","N-A","Agree a lot","N-A","Agree a lot","Disagree a lot","Agree a lot","Disagree a lot","Neither","Agree a little","Agree a little","Agree a lot","N-A","Agree a little","Neither","N-A","Disagree a lot","Neither","Agree a lot","Disagree a lot","Agree a lot","Agree a lot","N-A","Agree a little"],["1200800539","Jake","Powell","14","N-A","Agree a lot","Disagree a little","Agree a little","Agree a lot","Disagree a lot","Disagree a little","Agree a little","N-A","Disagree a little","Disagree a little","Neither","Agree a little","Agree a lot","Almost always","Most of the time","Most of the time","Almost never","N-A","Half the time","Most of the time","Most of the time","Most of the time","N-A","Almost always","Half the time","N-A","Sometimes","Sometimes","Never","Agree a lot","Agree a little","Agree a lot","Neither","Agree a lot","Disagree a lot","N-A","Agree a lot","Neither","Agree a lot","Agree a little","Neither","Neither","Agree a little","Disagree a lot","Disagree a little","Agree a lot","Disagree a little","Agree a little","Disagree a little","Neither","N-A","Agree a lot","Disagree a little","Disagree a little","N-A","Agree a little","Agree a little","N-A","N-A","N-A","N-A"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>1<\/th>\n      <th>2<\/th>\n      <th>3<\/th>\n      <th>4<\/th>\n      <th>5<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":300,"dom":"Bt","buttons":["copy","csv","excel","pdf"],"paging":false,"ordering":false,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"1","targets":1},{"name":"2","targets":2},{"name":"3","targets":3},{"name":"4","targets":4},{"name":"5","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><div class="section level3">
<h3 id="data-cleaning">Data Cleaning<a class="anchor" aria-label="anchor" href="#data-cleaning"></a>
</h3>
<p>Our first aim is to clean the data such that the data is ready to be
analysed and no further modifications are required. Note that after the
first clean we will need to do sanity checks in case there are other
issues in the data.</p>
<p>The initial part of cleaning will involve:</p>
<ul>
<li>Adding theme / group information to the column names. To using the
tools herein the column name of questions should be in the format
<code>XX__YY</code> where XX is the theme/group and YY the question (i.e
we use ’__’ double underscore to represent the split between group/theme
and the question).</li>
<li>Convert ‘N-A’ to NA.</li>
<li>Get the school ID from the bar code.</li>
<li>Create a combined school and class ID (in case multiple schools have
the same class ID).</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Clean 1. </span></span>
<span></span>
<span><span class="co"># A) Adding theme/group to column names.</span></span>
<span><span class="va">group</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'Theme 1'</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>,</span>
<span>          <span class="st">'Theme 2'</span><span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>, </span>
<span>          <span class="st">'Theme 3'</span><span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>, </span>
<span>          <span class="st">'Theme 4'</span><span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span>,</span>
<span>          <span class="st">'Theme 5'</span><span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">12</span><span class="op">)</span>, </span>
<span>          <span class="st">'Theme 6'</span><span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span>,</span>
<span>          <span class="st">'Theme 7'</span><span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span>, </span>
<span>          <span class="st">'Theme 8'</span><span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span>             </span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">group</span>, <span class="st">'__'</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">[</span><span class="fl">6</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html" class="external-link">str_replace_all</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">' '</span>, replacement <span class="op">=</span> <span class="st">'_'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># B) NAs</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span><span class="op">[</span><span class="va">data</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">==</span> <span class="st">'N-A'</span><span class="op">]</span> <span class="op">=</span> <span class="cn">NA</span></span>
<span>  <span class="co"># data[,i] = data[,i] |&gt; stringr::str_to_sentence() # commented out for example.</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># C + D) School ID and combine school and class information.</span></span>
<span><span class="va">school</span> <span class="op">=</span> <span class="va">data</span><span class="op">$</span><span class="va">Barcode_ID</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">school_and_class</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">school</span>,<span class="st">'__'</span>, <span class="va">data</span><span class="op">$</span><span class="va">`Group_/_class`</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># Combine into a cleaned dataset. </span></span>
<span><span class="va">data_clean</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">data</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, <span class="va">school</span>, <span class="va">school_and_class</span>, <span class="va">data</span><span class="op">[</span>,<span class="fl">5</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>We show the data for same 5 participants as before (transposed so the
table is easier to see).</p>
<div class="datatables html-widget html-fill-item" id="htmlwidget-e5c8c404fe174e4c81bd" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-e5c8c404fe174e4c81bd">{"x":{"filter":"none","vertical":false,"extensions":["Buttons"],"data":[["Barcode_ID","First_Name","Surname","Group_._class","school","school_and_class","Tick_Appropriate_Box_Only_if_the_Child_did_not_take_the_Test","Theme_1__Question_1","Theme_1__Question_2","Theme_1__Question_3","Theme_1__Question_4","Theme_1__Question_5","Theme_1__Question_6","Theme_2__Question_7","Theme_2__Question_8","Theme_2__Question_9","Theme_2__Question_10","Theme_2__Question_11","Theme_2__Question_12","Theme_2__Question_13","Theme_3__Question_14","Theme_3__Question_15","Theme_3__Question_16","Theme_3__Question_17","Theme_3__Question_18","Theme_3__Question_19","Theme_3__Question_20","Theme_3__Question_21","Theme_3__Question_22","Theme_3__Question_23","Theme_3__Question_24","Theme_3__Question_25","Theme_4__Question_26","Theme_4__Question_27","Theme_4__Question_28","Theme_4__Question_29","Theme_5__Question_30","Theme_5__Question_31","Theme_5__Question_32","Theme_5__Question_33","Theme_5__Question_34","Theme_5__Question_35","Theme_5__Question_36","Theme_5__Question_37","Theme_5__Question_38","Theme_5__Question_39","Theme_5__Question_40","Theme_5__Question_41","Theme_6__Question_42","Theme_6__Question_43","Theme_6__Question_44","Theme_6__Question_45","Theme_6__Question_46","Theme_6__Question_47","Theme_6__Question_48","Theme_7__Question_49","Theme_7__Question_50","Theme_7__Question_51","Theme_7__Question_52","Theme_7__Question_53","Theme_7__Question_54","Theme_8__Question_55","Theme_8__Question_56","Theme_8__Question_57","Theme_8__Question_58","Theme_8__Question_59","Theme_8__Question_60","Theme_8__Question_61"],["1200800551","Jake","Powell","15","008","008__15",null,"Agree a lot","Neither","Agree a little","Agree a little","Agree a lot","Agree a little","Agree a little","Agree a lot","Neither","Agree a lot",null,"Agree a little","Agree a little","Most of the time","Some of the time","Most of the time","Some of the time","Some of the time",null,"Most of the time",null,"Most of the time","Half the time",null,"Almost never","Never",null,"Never","Never",null,"Agree a lot","Agree a lot",null,"Agree a lot","Agree a lot","Disagree a lot",null,"Disagree a lot",null,null,"Disagree a little",null,"Neither","Disagree a little","Disagree a lot","Agree a little",null,"Neither","Neither","Neither","Disagree a lot","Neither","Agree a little","Disagree a lot","Agree a little","Agree a little","Agree a lot",null,"Agree a little",null,"Disagree a little"],["1200800439","Jake","Powell","11","008","008__11",null,"Agree a lot","Neither","Agree a lot","Agree a little","Agree a lot","Agree a little","Agree a little","Neither","Agree a lot","Agree a lot","Neither","Agree a little","Agree a little","Most of the time","Most of the time","Most of the time",null,"Most of the time",null,"Almost always","Most of the time","Some of the time","Some of the time",null,"Some of the time","Never",null,null,"Never","Agree a lot","Agree a lot","Disagree a little","Disagree a little","Disagree a lot","Agree a little","Disagree a lot","Disagree a little",null,"Neither","Agree a little","Disagree a lot","Agree a little",null,null,"Agree a little","Disagree a little","Neither","Agree a little","Neither","Disagree a lot","Agree a lot","Disagree a lot",null,"Agree a lot","Neither",null,"Neither","Agree a little","Agree a lot","Agree a lot","Neither"],["1200800442","Jake","Powell","11","008","008__11",null,"Agree a little",null,"Agree a little",null,"Disagree a little",null,"Agree a lot","Agree a little","Disagree a little","Disagree a little","Neither","Disagree a little","Disagree a lot","Most of the time",null,"Almost always",null,"Some of the time","Some of the time","Almost always","Half the time","Almost Never",null,"Some of the time","Most of the time",null,"Never","Never","Never","Neither",null,"Agree a lot",null,"Disagree a lot","Neither",null,"Disagree a lot",null,"Disagree a lot","Agree a lot","Disagree a little","Disagree a lot","Disagree a lot","Neither","Disagree a lot",null,"Agree a lot","Agree a little","Disagree a little","Neither","Disagree a lot","Agree a little",null,"Agree a little","Agree a little","Agree a little","Disagree a lot","Agree a little","Agree a lot",null,null],["1200800501","Jake","Powell","13","008","008__13",null,"Agree a little",null,"Agree a little","Agree a little","Disagree a lot","Agree a lot","Agree a lot","Agree a lot","Agree a little",null,null,"Neither","Neither","Half the time","Some of the time","Most of the time",null,"Most of the time","Almost never","Most of the time","Most of the time","Most of the time","Some of the time","Almost always",null,null,"Never",null,null,null,"Disagree a little","Agree a little","Agree a little","Agree a little","Agree a lot","Disagree a little","Disagree a lot","Neither",null,"Agree a lot",null,"Agree a lot","Disagree a lot","Agree a lot","Disagree a lot","Neither","Agree a little","Agree a little","Agree a lot",null,"Agree a little","Neither",null,"Disagree a lot","Neither","Agree a lot","Disagree a lot","Agree a lot","Agree a lot",null,"Agree a little"],["1200800539","Jake","Powell","14","008","008__14",null,"Agree a lot","Disagree a little","Agree a little","Agree a lot","Disagree a lot","Disagree a little","Agree a little",null,"Disagree a little","Disagree a little","Neither","Agree a little","Agree a lot","Almost always","Most of the time","Most of the time","Almost never",null,"Half the time","Most of the time","Most of the time","Most of the time",null,"Almost always","Half the time",null,"Sometimes","Sometimes","Never","Agree a lot","Agree a little","Agree a lot","Neither","Agree a lot","Disagree a lot",null,"Agree a lot","Neither","Agree a lot","Agree a little","Neither","Neither","Agree a little","Disagree a lot","Disagree a little","Agree a lot","Disagree a little","Agree a little","Disagree a little","Neither",null,"Agree a lot","Disagree a little","Disagree a little",null,"Agree a little","Agree a little",null,null,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>1<\/th>\n      <th>2<\/th>\n      <th>3<\/th>\n      <th>4<\/th>\n      <th>5<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"scrollY":300,"dom":"Bt","buttons":["copy","csv","excel","pdf"],"paging":false,"ordering":false,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"1","targets":1},{"name":"2","targets":2},{"name":"3","targets":3},{"name":"4","targets":4},{"name":"5","targets":5}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><p>After the first step of cleaning we see the addition of the school
and school_class combined columns new column names and NAs added.</p>
<p>After the first step of cleaning we can now run checks for other
errors in the dataset. To check for issues we can use
<code><a href="../reference/check_question_columns.html">check_survey()</a></code> which checks for barcode issues, unexpected
values in question columns and questions which have multiple answers
(i.e. a value of “99”).</p>
<p>The function returns a list informing if we have any issues of the
type listed above.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">check</span> <span class="op">=</span> <span class="fu">OMESurvey</span><span class="fu">::</span><span class="fu"><a href="../reference/check_question_columns.html">check_survey</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span></span>
<span><span class="va">check</span></span>
<span><span class="co">#&gt; $barcode</span></span>
<span><span class="co">#&gt; $barcode$isIssue</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $barcode$issues</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $question_text</span></span>
<span><span class="co">#&gt; $question_text$isIssue</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $question_text$issues</span></span>
<span><span class="co">#&gt;                question Unexpected.value Count  Indices</span></span>
<span><span class="co">#&gt; 5  Theme_3__Question_21          Neither     2 187, 352</span></span>
<span><span class="co">#&gt; 7  Theme_3__Question_22     Almost Never     1        3</span></span>
<span><span class="co">#&gt; 11 Theme_5__Question_41   DIsagree a lot     1      252</span></span>
<span><span class="co">#&gt;                                                                          expected</span></span>
<span><span class="co">#&gt; 5  Almost always, Most of the time, Half the time, Some of the time, Almost never</span></span>
<span><span class="co">#&gt; 7  Almost always, Most of the time, Half the time, Some of the time, Almost never</span></span>
<span><span class="co">#&gt; 11        Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $multiple_answers</span></span>
<span><span class="co">#&gt; $multiple_answers$isIssue</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $multiple_answers$issues</span></span>
<span><span class="co">#&gt;                question Unexpected.value Count       Indices</span></span>
<span><span class="co">#&gt; 1   Theme_1__Question_3               99     1           344</span></span>
<span><span class="co">#&gt; 2   Theme_1__Question_4               99     3 240, 251, 402</span></span>
<span><span class="co">#&gt; 3   Theme_2__Question_9               99     2      241, 260</span></span>
<span><span class="co">#&gt; 4  Theme_3__Question_20               99     1            56</span></span>
<span><span class="co">#&gt; 6  Theme_3__Question_21               99     1           387</span></span>
<span><span class="co">#&gt; 8  Theme_5__Question_32               99     2      272, 480</span></span>
<span><span class="co">#&gt; 9  Theme_5__Question_35               99     2      154, 177</span></span>
<span><span class="co">#&gt; 10 Theme_5__Question_37               99     1            21</span></span>
<span><span class="co">#&gt; 12 Theme_6__Question_44               99     2      278, 317</span></span>
<span><span class="co">#&gt; 13 Theme_7__Question_52               99     3  26, 128, 335</span></span>
<span><span class="co">#&gt; 14 Theme_8__Question_56               99     1           369</span></span>
<span><span class="co">#&gt;                                                                          expected</span></span>
<span><span class="co">#&gt; 1         Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 2         Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 3         Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 4  Almost always, Most of the time, Half the time, Some of the time, Almost never</span></span>
<span><span class="co">#&gt; 6  Almost always, Most of the time, Half the time, Some of the time, Almost never</span></span>
<span><span class="co">#&gt; 8         Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 9         Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 10        Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 12        Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 13        Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; 14        Agree a lot, Agree a little, Neither, Disagree a little, Disagree a lot</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $multiple_answers$barcodes</span></span>
<span><span class="co">#&gt;  [1] 1200700304 1200700360 1200700413 1200700392 1200700402 1200700410</span></span>
<span><span class="co">#&gt;  [7] 1200800516 1200700389 1200700423 1200900701 1200800572 1200800585</span></span>
<span><span class="co">#&gt; [13] 1200800456 1201000757 1201000896 1200800469 1200800497 1201000908</span></span>
<span><span class="co">#&gt; [19] 1200700320</span></span></code></pre></div>
<p>We see that most errors occur from casing issues (capital N in
never), since this isn’t case specific to this survey we can fix this
using <code><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">stringr::str_to_sentence()</a></code> in the cleaning section
(which is already there just commented out to show the issue). The issue
of ‘Neither’ being used instead of ‘Half the time’ is case specific and
can be fixed for this individual report.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run extra cleaning with issues found.</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">data_clean</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">=</span> <span class="va">data_clean</span><span class="op">[</span>,<span class="va">i</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/case.html" class="external-link">str_to_sentence</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># Fix neither to Half the time.</span></span>
<span><span class="va">data_clean</span><span class="op">$</span><span class="va">Theme_3__Question_21</span><span class="op">[</span><span class="va">data_clean</span><span class="op">$</span><span class="va">Theme_3__Question_21</span> <span class="op">==</span> <span class="st">'Neither'</span><span class="op">]</span> <span class="op">=</span> <span class="st">'Half the time'</span></span></code></pre></div>
<p>If we want to check the survey images for records where we have “99s”
we can filter the SharePoint search by the barcodes using the following
text</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">check</span><span class="op">$</span><span class="va">multiple_answers</span><span class="op">$</span><span class="va">barcodes</span>, collapse <span class="op">=</span> <span class="st">" OR "</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "1200700304 OR 1200700360 OR 1200700413 OR 1200700392 OR 1200700402 OR 1200700410 OR 1200800516 OR 1200700389 OR 1200700423 OR 1200900701 OR 1200800572 OR 1200800585 OR 1200800456 OR 1201000757 OR 1201000896 OR 1200800469 OR 1200800497 OR 1201000908 OR 1200700320"</span></span></code></pre></div>
<div class="section level4">
<h4 id="checking-for-issues-in-the-id">Checking for issues in the ID<a class="anchor" aria-label="anchor" href="#checking-for-issues-in-the-id"></a>
</h4>
<p>As a further precaution we may want to check that the IDs we have in
our survey dataset aligns with the information already held for ID and
name combinations. This will be useful to track issues in the ID,
changes in names or to check for children who used an ‘empty form’
rather then the survey meant for them (is it was missing or misplaced
for example).</p>
<p>Within <strong>OMESurvey</strong> the function
<code><a href="../reference/check_question_columns.html">check_IDs()</a></code> performs the ID checks. An example is shown
below.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Use a large extract of the data as the 'true' values</span></span>
<span><span class="va">true_df</span> <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span>,<span class="op">]</span></span>
<span></span>
<span><span class="co"># Small subset for our survey results.</span></span>
<span><span class="va">data_ex</span>  <span class="op">=</span> <span class="va">data</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="op">]</span></span>
<span><span class="co">#Change some names and IDs.</span></span>
<span><span class="va">data_ex</span><span class="op">$</span><span class="va">First_Name</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span> <span class="op">=</span> <span class="st">'Luke'</span></span>
<span><span class="va">data_ex</span><span class="op">$</span><span class="va">Barcode_ID</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">=</span> <span class="va">data_ex</span><span class="op">$</span><span class="va">Barcode_ID</span><span class="op">[</span><span class="fl">7</span><span class="op">]</span> <span class="op">|&gt;</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_extract.html" class="external-link">str_extract</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">'[0-9]{8}'</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># Check the IDs using </span></span>
<span><span class="fu"><a href="../reference/check_question_columns.html">check_IDs</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">data_ex</span>, true_df <span class="op">=</span> <span class="va">true_df</span><span class="op">)</span></span>
<span><span class="co">#&gt; $length_issue</span></span>
<span><span class="co">#&gt; [1] "12008005"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $inconsistent_issue</span></span>
<span><span class="co">#&gt;     Data: ID Data: First Name Data: Surname Potential:  ID</span></span>
<span><span class="co">#&gt; 1 1200800442             Luke        Powell           &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2   12008005             Jake        Powell     1200800551</span></span>
<span><span class="co">#&gt;   Potential: First Name Potential: Surname</span></span>
<span><span class="co">#&gt; 1                  Jake             Powell</span></span>
<span><span class="co">#&gt; 2                  &lt;NA&gt;               &lt;NA&gt;</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level3">
<h3 id="missingness-report">Missingness report<a class="anchor" aria-label="anchor" href="#missingness-report"></a>
</h3>
<p>Now we have cleaned the data we can create a missingness report to
explore if there are empty surveys, which questions are more often
missing, etc.</p>
<p>Within <strong>OMESurvey</strong> we have a pre-written markdown
report which takes survey data as an input and analyses the missingness.
Therefore we only need to run the function
<code><a href="../reference/create_missingness_report.html">create_missingness_report()</a></code> to create the report for
whichever survey data we are analysing.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create the missingness report.</span></span>
<span><span class="fu">OMESurvey</span><span class="fu">::</span><span class="fu"><a href="../reference/create_missingness_report.html">create_missingness_report</a></span><span class="op">(</span>survey_data <span class="op">=</span> <span class="va">data_clean</span>, </span>
<span>                                     survey_name <span class="op">=</span> <span class="st">'example survey'</span>,</span>
<span>                                     output_dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span></span>
<span>                                     <span class="op">)</span></span></code></pre></div>
<p>Note that by default this creates a .html report where the charts are
interactive (i.e has hover enabled, plus potential other features). This
allows for more informative charts however it comes at the cost of not
been able to edit the document. Therefore using the input
<code>report_kind = 'static'</code> will render the same report except
the output will be in .docx allowing text to be edited/added at the
expense of the interactive plots (where they will be replaced with
static screengrabs).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jake Powell.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
