---
title: "Create survey figures"
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(OMESurvey)
```

*This vignette provides examples for the simple creation of survey plots across different output types*

```{r load some data}
data = OMESurvey::survey_example

# Clean such that "N-A" values equal NA, fix any casing issues
for(i in 1:ncol(data)){
  data[,i][data[,i] == 'N-A'] = NA
  data[,i] = data[,i] |> stringr::str_to_sentence() 
}

```

## Number of responses across questions in a theme

In this case we can use `plot_theme()` to create a horizontal bar chart. Depending on the "Kind" argument we can create a ggplot, a plotly figure or a formatted data frame.

### {.tabset}

#### ggplot

```{r plot theme - ggplot}
OMESurvey::plot_theme(data, theme = 'Theme_1', kind = 'ggplot')
```


#### plotly

```{r plot theme - plotly}
OMESurvey::plot_theme(data, theme = 'Theme_1', kind = 'plotly')
```

#### data.frame

```{r plot theme data frame}
df = OMESurvey::plot_theme(data, theme = 'Theme_1', kind = 'data.frame')
df |> DT::datatable(extensions = 'Buttons',
                  rownames = F,
                  options = list(scrollY = 300,
                                 dom = 'Bt',
                                 buttons = c('copy', 'csv', 'excel', 'pdf'),
                                 paging=FALSE,
                                 ordering=F))
```

### {-}


Note that here we use default `survey_values = OMESurvey::survey_values` is used to find the expected values of the survey questions and the order to show the answers in the legend. For custom survey values you can change the `survey_values`. The function uses colours from `OMESurvey::get_OME_colours()`. For the plots either a ggplot or plotly object are returned, therefore + or |> can be used to update the plot (e.g layout/colours, etc). Or you can create your own plot from the data frame output.
***

## Number of responses across questions in a theme with a demographic

Need to add a demographic column so extract school from the bar code.

```{r}
school = data$Barcode_ID |> as.character() |>  substr(3, 5)
data$school = school
school_column = ncol(data)
```
### {.tabset}

#### ggplot

```{r plot theme demo - ggplot}
OMESurvey::plot_theme_by_demographic(data, theme = 'Theme_1', demographic_column = school_column,  kind = 'ggplot')
```


#### plotly

```{r plot theme demo - plotly}
OMESurvey::plot_theme_by_demographic(data, theme = 'Theme_1', demographic_column = school_column,  kind = 'plotly')
```

#### data.frame

```{r plot theme demo data frame}
# Get school information

df = OMESurvey::plot_theme_by_demographic(data, theme = 'Theme_1', demographic_column = school_column,  kind = 'data.frame')

df |> DT::datatable(extensions = 'Buttons',
                  rownames = F,
                  options = list(scrollY = 300,
                                 dom = 'Bt',
                                 buttons = c('copy', 'csv', 'excel', 'pdf'),
                                 paging=FALSE,
                                 ordering=F))
```

### {-}
