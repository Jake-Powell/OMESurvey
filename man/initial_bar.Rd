% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/survey_summary_functions.R
\name{initial_bar}
\alias{initial_bar}
\title{Make stacked bar chart (possibly split into separate bars and facetted) in the OME style. (Dave's version.)}
\usage{
initial_bar(
  dat,
  percCut = NULL,
  colo = NULL,
  na.rm = FALSE,
  horiz = FALSE,
  text_scale = 1,
  fillLabText = NULL,
  xLabText = NULL,
  yLabText = "Proportion of responses",
  titleText = NULL,
  facet_labels = NULL,
  facet_layout = NULL
)
}
\arguments{
\item{dat}{A data frame with 1–3 variables:
\itemize{
\item \strong{1 variable} → a single proportional bar.
\item \strong{2 variables} → separate bars for each level of the second variable.
\item \strong{3 variables} → facetted bars by the third variable.
All variables should be factors (characters may work but are not guaranteed).
}}

\item{percCut}{numeric scalar (0-100). Cutoff below which percentages are not shown in bar segments. Default \code{5}.}

\item{colo}{(optional but recommended) vector of colours to use for the fill scale (character vector of colours,
length the same as the number of levels of the factor that is the first variable of \code{dat}.)
If \code{NULL} (default) the pallete from \code{OMESurvey::get_OME_colours(type='distinct')} is used.
When \code{na.rm = FALSE} a grey colour is prepended for the "Missing" level.
Note that percentage labels are in white, so the pallete needs to work with that.
(... or this function needs upgrading!)}

\item{na.rm}{logical. If \code{TRUE} then remove \code{NA} responses from the data;
if \code{FALSE} (default) then they are converted to "Missing" and treated as an additional allowed response.}

\item{horiz}{logical (default FALSE) determining whether to coord_flip() so that bars are horizontal and place legend below the plot.}

\item{text_scale}{positive number (default 1) for scaling the size of the percentage and #response labels.}

\item{fillLabText}{Optional character. Label for the fill/legend.
If \code{NULL} (the default) the legend title is removed (no label).
If \code{""} the name of the first variable in \code{dat} is used.}

\item{xLabText}{optional text for labelling the second-variable-in-\code{dat} axis.
If \code{NULL} (the default) the label is removed (no label).
If \code{""} the name of the first variable in \code{dat} is used.}

\item{yLabText}{optional text for labelling the 'proportion' axis. Default \code{"Proportion of responses"}.}

\item{titleText}{optional text for plot title. With default \code{NULL} the title is removed.}

\item{facet_labels}{Optional named character vector used as a labeller for
facets (names are original facet values, values are labels to display).
Default \code{NULL} uses the values of that variable.}

\item{facet_layout}{Optional character. If \code{"1row"} the facets are
arranged in a single row; otherwise default facet layout is used.
(\code{"1col"} option planned but not yet supported.)}
}
\value{
A \code{ggplot} object (or a \code{cowplot} object if \code{cowplot} is installed)
}
\description{
\code{initial_bar} builds a (stacked, filled) proportional bar chart from a
tidy data frame of survey responses. The first column is treated as the
response factor (fill), the optional second column as the grouping/subdivision,
and the optional third column is used for faceting.
}
\details{
The plot displays:
\itemize{
\item relative frequencies of the first variable,
\item optional subdivision into separate bars,
\item optional faceting,
\item percentage labels inside bar segments (above a cutoff),
\item \code{(n)} labels showing the number of responses per bar.
}

The function returns a \code{ggplot} (or \code{cowplot} if it is installed) object ready for further customization or direct printing.

Percentages are displayed in segments that comprise at least \code{percCut} of their bar;
the percentage displayed is this rounded to a whole number.
}
\examples{
# Minimal example with two questions and three response levels
dat <- tibble::tibble(
  Response = factor(c("Yes", "No", "Yes", "Maybe")),
  Group    = factor(c("A", "A", "B", "B"))
)

initial_bar(dat)

# Horizontal version with a title
initial_bar(dat, horiz = TRUE, titleText = "Example bar chart")

}
